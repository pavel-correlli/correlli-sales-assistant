# План решения проблемы несоответствия данных

## 1. Исправление SQL Views и логики данных
Основная причина расхождений — использование старых или неполных views (`v_analytics_calls_enhanced`, `v_ceo_iron_metrics`) и отсутствие фильтрации по менеджерам.

### Действия:
1.  **Создание единого источника правды (Source of Truth):**
    Создам новое view `v_analytics_master`, которое будет зеркалировать таблицу `Algonova_Calls_Raw` но с правильной типизацией данных (даты, числа) и предварительно вычисленными полями (Market, Defined Status). Это исключит разночтения между Python и SQL.
2.  **Проверка WHERE/JOIN:**
    Проверю, что в views нет скрытых `INNER JOIN`, которые могут отсекать данные (например, если нет записи в таблице менеджеров).

## 2. Обновление Python кода (CSO Dashboard)
1.  **Интеграция фильтра по менеджерам:**
    В `app.py` добавлю мультиселектор для выбора менеджеров (на основе данных из базы). Этот список будет передаваться в `render_cso_dashboard`.
2.  **Применение фильтра:**
    В `cso_view.py` добавлю логику фильтрации:
    ```python
    if selected_managers:
        df = df[df['manager'].isin(selected_managers)]
    ```
3.  **Переход на Master View:**
    Заменю загрузку `Algonova_Calls_Raw` на `v_analytics_master` (после его создания) или продолжу использовать `Raw` с корректной пост-обработкой, но с добавлением явных логов количества строк.

## 3. Проверка связанности и документация
1.  **Проверка:** Убежусь, что количество строк для менеджера (например, 'Viktoria Kravec') совпадает с прямым SQL-запросом.
2.  **Memory:** Сохраню контекст о том, что "сырые" данные теперь являются приоритетными, а фильтрация должна быть явной.

Этот план решит проблему "потери" данных (сейчас они просто не фильтруются или фильтруются неявно) и даст вам точный контроль.